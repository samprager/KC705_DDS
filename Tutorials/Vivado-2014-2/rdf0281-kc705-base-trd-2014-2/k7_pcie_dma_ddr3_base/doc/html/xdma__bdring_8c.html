<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>

<title>xdma/xdma_bdring.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_a1b5f205ab88f17946855b7ba056a231.html">xdma</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">xdma_bdring.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kernel.h&gt;</code><br/>
<code>#include &lt;linux/string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="xbasic__types_8h_source.html">xbasic_types.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdebug_8h_source.html">xdebug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xstatus_8h_source.html">xstatus.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xio_8h_source.html">xio.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma__bdring_8h_source.html">xdma_bdring.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma__hw_8h_source.html">xdma_hw.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#a1f28b96e062f1a3cdff55a42f712116a">Dma_BdRingCreate</a> (Dma_BdRing *RingPtr, u32 PhysAddr, u32 VirtAddr, u32 Alignment, unsigned BdCount)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#a77800843381096be543f854420a69769">Dma_BdRingStart</a> (Dma_BdRing *RingPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#a26d30c4bf47c96018dd97fb76d9f389c">Dma_BdRingAlloc</a> (Dma_BdRing *RingPtr, unsigned NumBd, Dma_Bd **BdSetPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#a5a5400d1d2eeb0c4637e91710c8e72de">Dma_BdRingUnAlloc</a> (Dma_BdRing *RingPtr, unsigned NumBd, Dma_Bd *BdSetPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#adc84047791402b3cd694e670aa6e2d69">Dma_BdRingToHw</a> (Dma_BdRing *RingPtr, unsigned NumBd, Dma_Bd *BdSetPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#ab85128ed7e74275d698cb0d87bdeee93">Dma_BdRingFromHw</a> (Dma_BdRing *RingPtr, unsigned BdLimit, Dma_Bd **BdSetPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#ab10eaf6ff93b286d06e9b0957fb4c948">Dma_BdRingForceFromHw</a> (Dma_BdRing *RingPtr, unsigned BdLimit, Dma_Bd **BdSetPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#aad27432fbef9f2aea3af23a5a84bdc67">Dma_BdRingFree</a> (Dma_BdRing *RingPtr, unsigned NumBd, Dma_Bd *BdSetPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#a97885b12d49c1a0e9d086498b3beae01">Dma_BdRingCheck</a> (Dma_BdRing *RingPtr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">u32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__bdring_8c.html#a77ecd1c1fcfb643ef3fbd0fa2840a6b4">Dma_BdRingAlign</a> (u32 AllocPtr, u32 Size, u32 Align, u32 *Delta)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This file implements buffer descriptor ring related functions. For more information on this driver, see <a class="el" href="xdma_8h.html">xdma.h</a>.</p>
<pre>
 MODIFICATION HISTORY:</pre><pre> Ver   Who  Date     Changes
 ----- ---- -------- -------------------------------------------------------
 1.0   ps   06/30/09 First release
 </pre> </div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a77ecd1c1fcfb643ef3fbd0fa2840a6b4"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingAlign" ref="a77ecd1c1fcfb643ef3fbd0fa2840a6b4" args="(u32 AllocPtr, u32 Size, u32 Align, u32 *Delta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">u32 <a class="el" href="xdma__bdring_8c.html#a77ecd1c1fcfb643ef3fbd0fa2840a6b4">Dma_BdRingAlign</a> </td>
          <td>(</td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>AllocPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>Size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>Align</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32 *&#160;</td>
          <td class="paramname"><em>Delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Align the BD space.</p>
<p>The DMA engine requires aligned BDs. This function aligns the space as required by the caller.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">AllocPtr</td><td>is the virtual address of the allocated BD space. </td></tr>
    <tr><td class="paramname">Size</td><td>is the size of the allocated BD space. </td></tr>
    <tr><td class="paramname">Align</td><td>is the number of bytes of alignment required. </td></tr>
    <tr><td class="paramname">Delta</td><td>is the shift required in virtual and physical addresses in order to achieve the alignment. This should be applied by the caller.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Number of BDs that will fit in the re-aligned BD space.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd></dd></dl>

<p>Referenced by <a class="el" href="xdma__base_8c.html#ad5d703a389553efc7322a29711908ca4">descriptor_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a26d30c4bf47c96018dd97fb76d9f389c"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingAlloc" ref="a26d30c4bf47c96018dd97fb76d9f389c" args="(Dma_BdRing *RingPtr, unsigned NumBd, Dma_Bd **BdSetPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__bdring_8c.html#a26d30c4bf47c96018dd97fb76d9f389c">Dma_BdRingAlloc</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>NumBd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Dma_Bd **&#160;</td>
          <td class="paramname"><em>BdSetPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reserve locations in the BD ring. The set of returned BDs may be modified in preparation for future DMA transactions. Once the BDs are ready to be submitted to hardware, the application must call <a class="el" href="xdma__bdring_8c.html#adc84047791402b3cd694e670aa6e2d69">Dma_BdRingToHw()</a> in the same order which they were allocated here. Example:</p>
<pre>
        NumBd = 2;
        Status = Dma_RingBdAlloc(MyRingPtr, NumBd, &amp;MyBdSet);</pre><pre>        if (Status != XST_SUCCESS)
        {
            // Not enough BDs available for the request
        }</pre><pre>        CurBd = MyBdSet;
        for (i=0; i&lt;NumBd; i++)
        {
            // Prepare CurBd.....</pre><pre>            // Onto next BD
            CurBd = Dma_mBdRingNext(MyRingPtr, CurBd);
        }</pre><pre>        // Give list to hardware
        Status = Dma_BdRingToHw(MyRingPtr, NumBd, MyBdSet);
 </pre><p>A more advanced use of this function may allocate multiple sets of BDs. They must be allocated and given to hardware in the correct sequence: </p>
<pre>
        // Legal
        Dma_BdRingAlloc(MyRingPtr, NumBd1, &amp;MySet1);
        Dma_BdRingToHw(MyRingPtr, NumBd1, MySet1);</pre><pre>        // Legal
        Dma_BdRingAlloc(MyRingPtr, NumBd1, &amp;MySet1);
        Dma_BdRingAlloc(MyRingPtr, NumBd2, &amp;MySet2);
        Dma_BdRingToHw(MyRingPtr, NumBd1, MySet1);
        Dma_BdRingToHw(MyRingPtr, NumBd2, MySet2);</pre><pre>        // Not legal
        Dma_BdRingAlloc(MyRingPtr, NumBd1, &amp;MySet1);
        Dma_BdRingAlloc(MyRingPtr, NumBd2, &amp;MySet2);
        Dma_BdRingToHw(MyRingPtr, NumBd2, MySet2);
        Dma_BdRingToHw(MyRingPtr, NumBd1, MySet1);
 </pre><p>Use the APIs defined in <a class="el" href="xdma__bd_8h.html">xdma_bd.h</a> to modify individual BDs. Traversal of the BD set can be done using Dma_mBdRingNext() and Dma_mBdRingPrev().</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">RingPtr</td><td>is a pointer to the descriptor ring instance to be worked on. </td></tr>
    <tr><td class="paramname">NumBd</td><td>is the number of BDs to allocate </td></tr>
    <tr><td class="paramname">BdSetPtr</td><td>is an output parameter, it points to the first BD available for modification.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if the requested number of BDs was returned in the BdSetPtr parameter.</li>
<li>XST_FAILURE if there were not enough free BDs to satisfy the request.</li>
</ul>
</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be preempted by another Dma_BdRing function call that modifies the BD space. It is the caller's responsibility to provide a mutual exclusion mechanism.</dd>
<dd>
Do not modify more BDs than the number requested with the NumBd parameter. Doing so will lead to data corruption and system instability. </dd></dl>

<p>Referenced by <a class="el" href="xdma__user_8c.html#a3a4887f61ce11a3c112b861cd2651026">DmaSendPkt()</a>.</p>

</div>
</div>
<a class="anchor" id="a97885b12d49c1a0e9d086498b3beae01"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingCheck" ref="a97885b12d49c1a0e9d086498b3beae01" args="(Dma_BdRing *RingPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__bdring_8c.html#a97885b12d49c1a0e9d086498b3beae01">Dma_BdRingCheck</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check the internal data structures of the BD ring for the provided channel. The following checks are made:</p>
<ul>
<li>Is the BD ring linked correctly in physical address space.</li>
<li>Do the internal pointers point to BDs in the ring.</li>
<li>Do the internal counters add up.</li>
</ul>
<p>The channel should be stopped prior to calling this function.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">RingPtr</td><td>is a pointer to the descriptor ring to be worked on.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if no errors were found.</li>
<li>XST_DMA_SG_NO_LIST if the ring has not been created.</li>
<li>XST_IS_STARTED if the channel is not stopped.</li>
<li>XST_DMA_SG_LIST_ERROR if a problem is found with the internal data structures. If this value is returned, the channel should be reset to avoid data corruption or system instability.</li>
</ul>
</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be preempted by another Dma ring function call that modifies the BD space. It is the caller's responsibility to provide a mutual exclusion mechanism. </dd></dl>

</div>
</div>
<a class="anchor" id="a1f28b96e062f1a3cdff55a42f712116a"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingCreate" ref="a1f28b96e062f1a3cdff55a42f712116a" args="(Dma_BdRing *RingPtr, u32 PhysAddr, u32 VirtAddr, u32 Alignment, unsigned BdCount)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__bdring_8c.html#a1f28b96e062f1a3cdff55a42f712116a">Dma_BdRingCreate</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>PhysAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>VirtAddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">u32&#160;</td>
          <td class="paramname"><em>Alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>BdCount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Using a memory segment allocated by the caller, create and setup the BD list for the given SGDMA ring.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">RingPtr</td><td>is the ring to be worked on. </td></tr>
    <tr><td class="paramname">PhysAddr</td><td>is the physical base address of allocated memory region. </td></tr>
    <tr><td class="paramname">VirtAddr</td><td>is the virtual base address of the allocated memory region. </td></tr>
    <tr><td class="paramname">Alignment</td><td>governs the byte alignment of individual BDs. This function will enforce a minimum alignment of DMA_BD_MINIMUM_ALIGNMENT bytes with no maximum as long as it is specified as a power of 2. </td></tr>
    <tr><td class="paramname">BdCount</td><td>is the number of BDs to set up in the application memory region. It is assumed the region is large enough to contain the BDs. Refer to the "SGDMA Descriptor Ring Creation" section in <a class="el" href="xdma_8h.html">xdma.h</a> for more information. The minimum valid value for this parameter is 1.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd></dd></dl>
<ul>
<li>XST_SUCCESS if initialization was successful</li>
<li>XST_INVALID_PARAM under any of the following conditions: 1) PhysAddr and/or VirtAddr are not aligned to the given Alignment parameter; 2) Alignment parameter does not meet minimum requirements or is not a power of 2 value; 3) BdCount is 0.</li>
<li>XST_DMA_SG_LIST_ERROR if the memory segment containing the list spans over address 0x00000000 in virtual address space. </li>
</ul>

<p>Referenced by <a class="el" href="xdma__base_8c.html#ad5d703a389553efc7322a29711908ca4">descriptor_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ab10eaf6ff93b286d06e9b0957fb4c948"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingForceFromHw" ref="ab10eaf6ff93b286d06e9b0957fb4c948" args="(Dma_BdRing *RingPtr, unsigned BdLimit, Dma_Bd **BdSetPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="xdma__bdring_8c.html#ab10eaf6ff93b286d06e9b0957fb4c948">Dma_BdRingForceFromHw</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>BdLimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Dma_Bd **&#160;</td>
          <td class="paramname"><em>BdSetPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns a set of BDs that had been enqueued to hardware, whether the hardware has processed them yet or not. This should be called only when the driver is freeing up buffers and about to free the ring. The returned BDs may be examined by the caller in order to recover the buffers. Once the BDs have been examined, the caller must call <a class="el" href="xdma__bdring_8c.html#aad27432fbef9f2aea3af23a5a84bdc67">Dma_BdRingFree()</a> in the same order which they were retrieved here.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">RingPtr</td><td>is a pointer to the descriptor ring instance to be worked on. </td></tr>
    <tr><td class="paramname">BdLimit</td><td>is the maximum number of BDs to return in the set. Use DMA_ALL_BDS to return all BDs that have been processed. </td></tr>
    <tr><td class="paramname">BdSetPtr</td><td>is an output parameter, it points to the first BD available for examination.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of BDs processed by hardware. A value of 0 indicates that no data is available. No more than BdLimit BDs will be returned.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Treat BDs returned by this function as read-only.</dd>
<dd>
This function should not be preempted by another Dma ring function call that modifies the BD space. It is the caller's responsibility to provide a mutual exclusion mechanism. </dd></dl>

<p>Referenced by <a class="el" href="xdma__base_8c.html#a81c8783e19a2f1f2c50f8273b286c50d">descriptor_free()</a>.</p>

</div>
</div>
<a class="anchor" id="aad27432fbef9f2aea3af23a5a84bdc67"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingFree" ref="aad27432fbef9f2aea3af23a5a84bdc67" args="(Dma_BdRing *RingPtr, unsigned NumBd, Dma_Bd *BdSetPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__bdring_8c.html#aad27432fbef9f2aea3af23a5a84bdc67">Dma_BdRingFree</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>NumBd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Dma_Bd *&#160;</td>
          <td class="paramname"><em>BdSetPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Frees a set of BDs that had been previously retrieved with <a class="el" href="xdma__bdring_8c.html#ab85128ed7e74275d698cb0d87bdeee93">Dma_BdRingFromHw()</a>. This function also clear all control/status bits (like SOP/EOP) of each BD in the set.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">RingPtr</td><td>is a pointer to the descriptor ring instance to be worked on. </td></tr>
    <tr><td class="paramname">NumBd</td><td>is the number of BDs to free. </td></tr>
    <tr><td class="paramname">BdSetPtr</td><td>is the head of a list of BDs returned by <a class="el" href="xdma__bdring_8c.html#ab85128ed7e74275d698cb0d87bdeee93">Dma_BdRingFromHw()</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if the set of BDs was freed.</li>
<li>XST_DMA_SG_LIST_ERROR if this function was called out of sequence with <a class="el" href="xdma__bdring_8c.html#ab85128ed7e74275d698cb0d87bdeee93">Dma_BdRingFromHw()</a>.</li>
</ul>
</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be preempted by another Dma function call that modifies the BD space. It is the caller's responsibility to provide a mutual exclusion mechanism. </dd></dl>

<p>Referenced by <a class="el" href="xdma__base_8c.html#a81c8783e19a2f1f2c50f8273b286c50d">descriptor_free()</a>.</p>

</div>
</div>
<a class="anchor" id="ab85128ed7e74275d698cb0d87bdeee93"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingFromHw" ref="ab85128ed7e74275d698cb0d87bdeee93" args="(Dma_BdRing *RingPtr, unsigned BdLimit, Dma_Bd **BdSetPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="xdma__bdring_8c.html#ab85128ed7e74275d698cb0d87bdeee93">Dma_BdRingFromHw</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>BdLimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Dma_Bd **&#160;</td>
          <td class="paramname"><em>BdSetPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Returns a set of BDs that have been processed by hardware. The returned BDs may be examined by the caller to determine the outcome of the DMA transactions. Once the BDs have been examined, the caller must call <a class="el" href="xdma__bdring_8c.html#aad27432fbef9f2aea3af23a5a84bdc67">Dma_BdRingFree()</a> in the same order which they were retrieved here.</p>
<p>Example:</p>
<pre>
        NumBd = Dma_BdRingFromHw(MyRingPtr, DMA_ALL_BDS, &amp;MyBdSet);</pre><pre>        if (NumBd == 0)
        {
           // hardware has nothing ready for us yet.
        }</pre><pre>        CurBd = MyBdSet;
        for (i=0; i&lt;NumBd; i++)
        {
           // Examine CurBd for post processing.....</pre><pre>           // Onto next BD
           CurBd = Dma_mBdRingNext(MyRingPtr, CurBd);
        }</pre><pre>        Dma_BdRingFree(MyRingPtr, NumBd, MyBdSet); // Return the list
 </pre><p>A more advanced use of this function may allocate multiple sets of BDs. They must be retrieved from hardware and freed in the correct sequence: </p>
<pre>
        // Legal
        Dma_BdRingFromHw(MyRingPtr, NumBd1, &amp;MySet1);
        Dma_BdRingFree(MyRingPtr, NumBd1, MySet1);</pre><pre>        // Legal
        Dma_BdRingFromHw(MyRingPtr, NumBd1, &amp;MySet1);
        Dma_BdRingFromHw(MyRingPtr, NumBd2, &amp;MySet2);
        Dma_BdRingFree(MyRingPtr, NumBd1, MySet1);
        Dma_BdRingFree(MyRingPtr, NumBd2, MySet2);</pre><pre>        // Not legal
        Dma_BdRingFromHw(MyRingPtr, NumBd1, &amp;MySet1);
        Dma_BdRingFromHw(MyRingPtr, NumBd2, &amp;MySet2);
        Dma_BdRingFree(MyRingPtr, NumBd2, MySet2);
        Dma_BdRingFree(MyRingPtr, NumBd1, MySet1);
 </pre><p>If hardware has partially completed a packet spanning multiple BDs, then none of the BDs for that packet will be included in the results.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">RingPtr</td><td>is a pointer to the descriptor ring instance to be worked on. </td></tr>
    <tr><td class="paramname">BdLimit</td><td>is the maximum number of BDs to return in the set. Use DMA_ALL_BDS to return all BDs that have been processed. </td></tr>
    <tr><td class="paramname">BdSetPtr</td><td>is an output parameter, it points to the first BD available for examination.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The number of BDs processed by hardware. A value of 0 indicates that no data is available. No more than BdLimit BDs will be returned.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Treat BDs returned by this function as read-only.</dd>
<dd>
This function should not be preempted by another Dma ring function call that modifies the BD space. It is the caller's responsibility to provide a mutual exclusion mechanism. </dd></dl>

</div>
</div>
<a class="anchor" id="a77800843381096be543f854420a69769"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingStart" ref="a77800843381096be543f854420a69769" args="(Dma_BdRing *RingPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__bdring_8c.html#a77800843381096be543f854420a69769">Dma_BdRingStart</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Allow DMA transactions to commence on the given channels if descriptors are ready to be processed.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">EngPtr</td><td>is a pointer to the engine instance to be worked on.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if the channel was started.</li>
<li>XST_DMA_SG_NO_LIST if the channel has no initialized BD ring. </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="xdma__user_8c.html#abdaa00f7453cce5fc24cb3ff3df4331a">DmaRegister()</a>.</p>

</div>
</div>
<a class="anchor" id="adc84047791402b3cd694e670aa6e2d69"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingToHw" ref="adc84047791402b3cd694e670aa6e2d69" args="(Dma_BdRing *RingPtr, unsigned NumBd, Dma_Bd *BdSetPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__bdring_8c.html#adc84047791402b3cd694e670aa6e2d69">Dma_BdRingToHw</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>NumBd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Dma_Bd *&#160;</td>
          <td class="paramname"><em>BdSetPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Enqueue a set of BDs to hardware that were previously allocated by <a class="el" href="xdma__bdring_8c.html#a26d30c4bf47c96018dd97fb76d9f389c">Dma_BdRingAlloc()</a>. Once this function returns, the argument BD set goes under hardware control. Any changes made to these BDs after this point will corrupt the BD list leading to data corruption and system instability.</p>
<p>The set will be rejected if the last BD of the set does not mark the end of a packet.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">RingPtr</td><td>is a pointer to the descriptor ring instance to be worked on. </td></tr>
    <tr><td class="paramname">NumBd</td><td>is the number of BDs in the set. </td></tr>
    <tr><td class="paramname">BdSetPtr</td><td>is the first BD of the set to commit to hardware.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if the set of BDs was accepted and enqueued to hardware</li>
<li>XST_FAILURE if the set of BDs was rejected because the first BD did not have its start-of-packet bit set, the last BD did not have its end-of-packet bit set, or any one of the BD set has 0 as length value</li>
<li>XST_DMA_SG_LIST_ERROR if this function was called out of sequence with <a class="el" href="xdma__bdring_8c.html#a26d30c4bf47c96018dd97fb76d9f389c">Dma_BdRingAlloc()</a></li>
</ul>
</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be preempted by another Dma ring function call that modifies the BD space. It is the caller's responsibility to provide a mutual exclusion mechanism. </dd></dl>

<p>Referenced by <a class="el" href="xdma__user_8c.html#a3a4887f61ce11a3c112b861cd2651026">DmaSendPkt()</a>.</p>

</div>
</div>
<a class="anchor" id="a5a5400d1d2eeb0c4637e91710c8e72de"></a><!-- doxytag: member="xdma_bdring.c::Dma_BdRingUnAlloc" ref="a5a5400d1d2eeb0c4637e91710c8e72de" args="(Dma_BdRing *RingPtr, unsigned NumBd, Dma_Bd *BdSetPtr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__bdring_8c.html#a5a5400d1d2eeb0c4637e91710c8e72de">Dma_BdRingUnAlloc</a> </td>
          <td>(</td>
          <td class="paramtype">Dma_BdRing *&#160;</td>
          <td class="paramname"><em>RingPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned&#160;</td>
          <td class="paramname"><em>NumBd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Dma_Bd *&#160;</td>
          <td class="paramname"><em>BdSetPtr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Fully or partially undo a <a class="el" href="xdma__bdring_8c.html#a26d30c4bf47c96018dd97fb76d9f389c">Dma_BdRingAlloc()</a> operation. Use this function if all the BDs allocated by <a class="el" href="xdma__bdring_8c.html#a26d30c4bf47c96018dd97fb76d9f389c">Dma_BdRingAlloc()</a> could not be transferred to hardware with <a class="el" href="xdma__bdring_8c.html#adc84047791402b3cd694e670aa6e2d69">Dma_BdRingToHw()</a>.</p>
<p>This function helps out in situations when an unrelated error occurs after BDs have been allocated but before they have been given to hardware.</p>
<p>This function is not the same as <a class="el" href="xdma__bdring_8c.html#aad27432fbef9f2aea3af23a5a84bdc67">Dma_BdRingFree()</a>. The Free function returns BDs to the free list after they have been processed by hardware, while UnAlloc returns them before being processed by hardware.</p>
<p>There are two scenarios where this function can be used. Full UnAlloc or Partial UnAlloc. A Full UnAlloc means all the BDs Alloc'd will be returned:</p>
<pre>
    Status = Dma_BdRingAlloc(MyRingPtr, 10, &amp;BdPtr);    if (Error)
    {
        Status = Dma_BdRingUnAlloc(MyRingPtr, 10, &amp;BdPtr);
    }
 </pre><p>A partial UnAlloc means some of the BDs Alloc'd will be returned:</p>
<pre>
    Status = Dma_BdRingAlloc(MyRingPtr, 10, &amp;BdPtr);
    BdsLeft = 10;
    CurBdPtr = BdPtr;</pre><pre>    while (BdsLeft)
    {
       if (Error)
       {
          Status = Dma_BdRingUnAlloc(MyRingPtr, BdsLeft, CurBdPtr);
       }</pre><pre>       CurBdPtr = Dma_mBdRingNext(MyRingPtr, CurBdPtr);
       BdsLeft--;
    }
 </pre><p>A partial UnAlloc must include the last BD in the list that was Alloc'd.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">RingPtr</td><td>is a pointer to the descriptor ring instance to be worked on. </td></tr>
    <tr><td class="paramname">NumBd</td><td>is the number of BDs to unallocate </td></tr>
    <tr><td class="paramname">BdSetPtr</td><td>points to the first of the BDs to be returned.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>XST_SUCCESS if the BDs were unallocated.</li>
<li>XST_FAILURE if NumBd parameter was greater that the number of BDs in the preprocessing state.</li>
</ul>
</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be preempted by another Dma ring function call that modifies the BD space. It is the caller's responsibility to provide a mutual exclusion mechanism. </dd></dl>

<p>Referenced by <a class="el" href="xdma__user_8c.html#a3a4887f61ce11a3c112b861cd2651026">DmaSendPkt()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 13 2012 18:57:54 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
