<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>

<title>xdma/xdma_user.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_a1b5f205ab88f17946855b7ba056a231.html">xdma</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">xdma_user.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;linux/kernel.h&gt;</code><br/>
<code>#include &lt;linux/timer.h&gt;</code><br/>
<code>#include &lt;linux/jiffies.h&gt;</code><br/>
<code>#include &lt;linux/pci.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="xbasic__types_8h_source.html">xbasic_types.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdebug_8h_source.html">xdebug.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xstatus_8h_source.html">xstatus.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xio_8h_source.html">xio.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma_8h_source.html">xdma.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma__bd_8h_source.html">xdma_bd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma__user_8h_source.html">xdma_user.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="xdma__hw_8h_source.html">xdma_hw.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__user_8c.html#abdaa00f7453cce5fc24cb3ff3df4331a">DmaRegister</a> (int engine, int bar, <a class="el" href="structUserPtrs.html">UserPtrs</a> *uptr, int pktsize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__user_8c.html#a4104c7117330f48cb334c5c08538ad8e">DmaUnregister</a> (void *handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5cd1b9be90dc2a14c6904095f4ed8507"></a><!-- doxytag: member="xdma_user.c::DmaFifoEmptyWait" ref="a5cd1b9be90dc2a14c6904095f4ed8507" args="(int handleId, u32 type)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>DmaFifoEmptyWait</b> (int handleId, u32 type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="xdma__user_8c.html#a3a4887f61ce11a3c112b861cd2651026">DmaSendPkt</a> (void *handle, <a class="el" href="structPktBuf.html">PktBuf</a> *pkts, int numpkts)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Contains the APIs used by the application-specific drivers.</p>
<p>Author: Xilinx, Inc.</p>
<p>2007-2010 (c) Xilinx, Inc. This file is licensed uner the terms of the GNU General Public License version 2.1. This program is licensed "as is" without any warranty of any kind, whether express or implied.</p>
<pre>
 MODIFICATION HISTORY:</pre><pre> Ver   Date     Changes
 ----- -------- -------------------------------------------------------
 1.0   12/07/09 First release
 </pre> </div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="abdaa00f7453cce5fc24cb3ff3df4331a"></a><!-- doxytag: member="xdma_user.c::DmaRegister" ref="abdaa00f7453cce5fc24cb3ff3df4331a" args="(int engine, int bar, UserPtrs *uptr, int pktsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* <a class="el" href="xdma__user_8c.html#abdaa00f7453cce5fc24cb3ff3df4331a">DmaRegister</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>engine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structUserPtrs.html">UserPtrs</a> *&#160;</td>
          <td class="paramname"><em>uptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pktsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function must be called by the user driver to register itself with the base DMA driver. After doing required checks to verify the choice of engine and BAR register, it initializes the engine and the BD ring associated with the engine, and enables interrupts if required.</p>
<p>Only one user is supported per engine at any given time. Incase the engine has already been registered with another user driver, an error will be returned.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">engine</td><td>is the DMA engine the user driver wants to use. </td></tr>
    <tr><td class="paramname">bar</td><td>is the BAR register the user driver wants to use. </td></tr>
    <tr><td class="paramname">uptr</td><td>is a pointer to the function callbacks in the user driver. </td></tr>
    <tr><td class="paramname">pktsize</td><td>is the size of packets that the user driver will normally use.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NULL incase of any error in completing the registration. </dd>
<dd>
Handle with which the user driver is registered.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be called in an interrupt context </dd></dl>

<p>References <a class="el" href="xdma__base_8c.html#ad5d703a389553efc7322a29711908ca4">descriptor_init()</a>, <a class="el" href="xdma__bdring_8c.html#a77800843381096be543f854420a69769">Dma_BdRingStart()</a>, <a class="el" href="xdma__base_8c.html#aafe97d27b1b23279ec57b4c8f64d2369">dmaData</a>, <a class="el" href="xdma__user_8h.html#a05b386d4bad60f6f9236de6d3be866e0">INITIALIZED</a>, <a class="el" href="structUserPtrs.html#afe89e8b90c431ce9f86587b56bfcd096">UserPtrs::privData</a>, <a class="el" href="xdma__user_8h.html#a9c24e8534e32ca5c349ed6b2c6ce1609">USER_ASSIGNED</a>, and <a class="el" href="structUserPtrs.html#ac49aa8a8d59b855f685b8e0822b2f483">UserPtrs::UserInit</a>.</p>

</div>
</div>
<a class="anchor" id="a3a4887f61ce11a3c112b861cd2651026"></a><!-- doxytag: member="xdma_user.c::DmaSendPkt" ref="a3a4887f61ce11a3c112b861cd2651026" args="(void *handle, PktBuf *pkts, int numpkts)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__user_8c.html#a3a4887f61ce11a3c112b861cd2651026">DmaSendPkt</a> </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structPktBuf.html">PktBuf</a> *&#160;</td>
          <td class="paramname"><em>pkts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numpkts</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function must be called by the user driver to unregister itself from the base DMA driver. After doing required checks to verify the handle and engine state, the DMA engine is reset, interrupts are disabled if required, and the BD ring is freed, while returning all the packet buffers to the user driver.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>is the handle which was assigned during the registration process. </td></tr>
    <tr><td class="paramname">pkts</td><td>is a <a class="el" href="structPktBuf.html">PktBuf</a> array, with the array of packets to be sent. </td></tr>
    <tr><td class="paramname">numpkts</td><td>is the number of packets in the <a class="el" href="structPktBuf.html">PktBuf</a> array.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 incase of any error </dd>
<dd>
Number of packets successfully queued for DMA send, incase of success.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>There may not be enough BDs to accomodate the number of packets requested by the user driver, so the returned value may not match with the requested numpkts. The user driver must be written to manage this appropriately. </dd></dl>

<p>References <a class="el" href="structPktBuf.html#a87fb8738bfe6eb767d62cadef8c802f9">PktBuf::bufInfo</a>, <a class="el" href="xdma__bdring_8c.html#a26d30c4bf47c96018dd97fb76d9f389c">Dma_BdRingAlloc()</a>, <a class="el" href="xdma__bdring_8c.html#adc84047791402b3cd694e670aa6e2d69">Dma_BdRingToHw()</a>, <a class="el" href="xdma__bdring_8c.html#a5a5400d1d2eeb0c4637e91710c8e72de">Dma_BdRingUnAlloc()</a>, <a class="el" href="structPktBuf.html#ae9a886f5f8e82480463ca54275b34d71">PktBuf::flags</a>, <a class="el" href="xdma__user_8h.html#a05b386d4bad60f6f9236de6d3be866e0">INITIALIZED</a>, <a class="el" href="xdma__user_8h.html#a7e071abf95b75e2d2015a5e635061627">PKT_ALL</a>, <a class="el" href="structPktBuf.html#a84f064bb9ca734326486a2da9584a86a">PktBuf::pktBuf</a>, <a class="el" href="structPktBuf.html#a36c05348038de53663b11f5c5aafce17">PktBuf::size</a>, <a class="el" href="xdma__user_8h.html#a9c24e8534e32ca5c349ed6b2c6ce1609">USER_ASSIGNED</a>, and <a class="el" href="structPktBuf.html#ac717ea327a8dd2d5b306d26169ab8b26">PktBuf::userInfo</a>.</p>

</div>
</div>
<a class="anchor" id="a4104c7117330f48cb334c5c08538ad8e"></a><!-- doxytag: member="xdma_user.c::DmaUnregister" ref="a4104c7117330f48cb334c5c08538ad8e" args="(void *handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="xdma__user_8c.html#a4104c7117330f48cb334c5c08538ad8e">DmaUnregister</a> </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function must be called by the user driver to unregister itself from the base DMA driver. After doing required checks to verify the handle and engine state, the DMA engine is reset, interrupts are disabled if required, and the BD ring is freed, while returning all the packet buffers to the user driver.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">handle</td><td>is the handle which was assigned during the registration process.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>XST_FAILURE incase of any error </dd>
<dd>
0 incase of success</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function should not be called in an interrupt context </dd></dl>

<p>References <a class="el" href="xdma__base_8c.html#a81c8783e19a2f1f2c50f8273b286c50d">descriptor_free()</a>, <a class="el" href="xdma_8c.html#aa95c53b30b03661caea5e5c1279acd58">Dma_Reset()</a>, <a class="el" href="xdma__base_8c.html#aafe97d27b1b23279ec57b4c8f64d2369">dmaData</a>, <a class="el" href="xdma__user_8h.html#a05b386d4bad60f6f9236de6d3be866e0">INITIALIZED</a>, <a class="el" href="xdma__user_8h.html#af633e59bd3235afc0e3ce5bb08376e39">UNREGISTERING</a>, and <a class="el" href="xdma__user_8h.html#a9c24e8534e32ca5c349ed6b2c6ce1609">USER_ASSIGNED</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 13 2012 18:57:54 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
